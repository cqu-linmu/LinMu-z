<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>车辆坐标转换</title>
    <link href="/linmu-blog/2024/08/27/%E8%BD%A6%E8%BE%86%E5%9D%90%E6%A0%87%E8%BD%AC%E6%8D%A2/"/>
    <url>/linmu-blog/2024/08/27/%E8%BD%A6%E8%BE%86%E5%9D%90%E6%A0%87%E8%BD%AC%E6%8D%A2/</url>
    
    <content type="html"><![CDATA[<h1 id="车辆坐标转换">车辆坐标转换</h1><p>解决问题：<br /> 1）地球是不规则的球体，两极扁，赤道鼓。不能简单地做为圆球体来计算；<br /> 2）每纬度在地理位置上的距离是一致的（约111 km），但是每经度之间的距离是不同的（越往两极，东西方向上的距离就越小），不能直接转换为直角坐标系；</p><p>WGS84坐标系全称World Geodetic System -1984，是为了解决GPS定位而产生的全球统一的一个地心坐标系。<br /> ●椭球体：WGS84椭球 <br /> ● 长半径<spanclass="math inline">\(a=6378137m\)</span> <br /> ● 短半径<spanclass="math inline">\(b=6356752.3142m\)</span> <br /> ●第一偏心率平方<spanclass="math inline">\({e_1}^2=0.00669437999013\)</span> <br /> ●第二偏心率平方<spanclass="math inline">\({e_2}^2=0.006739496742227\)</span> <br /> ●扁率<span class="math inline">\(\alpha=1/298.257223563\)</span></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> CenterCoordinate <span class="hljs-title function_">createCenterCoordinateFromBLH</span><span class="hljs-params">(<span class="hljs-type">double</span> latitude, <span class="hljs-type">double</span> longitude, <span class="hljs-type">double</span> altitude)</span> &#123;<br>    <span class="hljs-type">double</span> <span class="hljs-variable">B</span> <span class="hljs-operator">=</span> Math.toRadians(latitude);<br>    <span class="hljs-type">double</span> <span class="hljs-variable">L</span> <span class="hljs-operator">=</span> Math.toRadians(longitude);<br>    <span class="hljs-type">double</span> <span class="hljs-variable">N</span> <span class="hljs-operator">=</span> r/Math.sqrt(<span class="hljs-number">1</span>-e*e*Math.sin(B)*Math.sin(B));<br>    <span class="hljs-type">double</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> (N+altitude)*Math.cos(B)*Math.cos(L);<br>    <span class="hljs-type">double</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> (N+altitude)*Math.cos(B)*Math.sin(L);<br>    <span class="hljs-type">double</span> <span class="hljs-variable">z</span> <span class="hljs-operator">=</span> (N*(<span class="hljs-number">1</span>-e*e)+altitude)*Math.sin(B);<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CenterCoordinate</span>(x,y,z);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="车辆方向转换">车辆方向转换</h1><p>上面将经纬度转换为了地心直角坐标，然而速度方向拿到则是一个大陆坐标系下的与正北方的顺时针夹角。所以这里要对其进行转换。<br /></p><embed id="embed" src="大地二位坐标转地心直角三维坐标.drawio.svg" type="image/svg+xml"><p>假设条件：</p><ol type="1"><li>车辆所处大陆平面坐标系与地球球面相切</li></ol><p>已知条件为：</p><ol type="1"><li>车辆坐标 <span class="math inline">\((x_a,y_a,z_a)\)</span></li><li>车辆速度方向与正北方顺时针夹角 <spanclass="math inline">\(\theta\)</span></li></ol><p>首先，根据已知条件1可得车辆所属的平面的一个法向量和平面点法式方程如下：<span class="math display">\[ \overrightarrow{OA} =    \begin{bmatrix}        x_a \\        y_a \\        z_a    \end{bmatrix} \]</span> <span class="math display">\[ x_a(x-x_a) +y_a(y-y_a) + z_a(z-z_a) = 0 \]</span></p><p>根据假设条件1可知，平面内向北的向量 <spanclass="math inline">\(\overrightarrow{O&#39;N}\)</span>这里令其为 <spanclass="math inline">\(\overrightarrow{North}\)</span>与坐标下的Z轴交于 N点。<br /> 首先根据向量加法得到： <span class="math display">\[\overrightarrow{ON} = \overrightarrow{OO&#39;} + \overrightarrow{O‘N}\]</span></p><p>把上式与平面方程联立可得： <span class="math display">\[\overrightarrow{North} =    \begin{bmatrix}        -x_a \\        -y_a \\        \frac{x_a^2+{y_a}^2}{z_a}    \end{bmatrix} \]</span></p><p>根据已知条件<spanclass="math inline">\(\overrightarrow{Speed}\)</span>为车辆速度的单位向量所以有：<span class="math display">\[ \vert \overrightarrow{Speed} \vert = 1\]</span></p><p>根据向量点乘公式： <span class="math display">\[\overrightarrow{North} \cdot \overrightarrow{Speed} = \vert\overrightarrow{North} \vert \vert \overrightarrow{Speed} \vert\cos{\theta} \]</span></p><p>向量 <spanclass="math inline">\(\overrightarrow{Speed}\)</span>在平面上，则其与平面法向量垂直：<span class="math display">\[ \overrightarrow{OA} \cdot\overrightarrow{Speed} = 0 \]</span></p><p>联立上述三个公式得到向量 <spanclass="math inline">\(\overrightarrow{Speed}\)</span>表达式如下：<br />辅助符号： <span class="math display">\[ D_{xy} = {x_{a}}^2+{y_{a}}^2\]</span> <span class="math display">\[ D_{xyz} ={x_{a}}^2+{y_{a}}^2+{z_{a}}^2 \]</span> <span class="math display">\[ V= \sqrt{\frac{1-\cos^2{\theta}}{D_{xy}}} \]</span> <spanclass="math display">\[ U = \sqrt{ \frac{D_{xy} D_{xyz}}{z_a^2} }\]</span></p><p>解1： <span class="math display">\[ \overrightarrow{Speed_1} =    \begin{bmatrix}        yV - \frac{x_{a} z_{a}^2 U\cos{\theta}}{D_{xy} D_{xyz}} \\        -xV - \frac{y z^2 U \cos{\theta}}{D_{xy} D_{xyz}} \\        \frac{z_{a} U \cos{\theta}}{D_{xyz}}    \end{bmatrix} \]</span> 解2： <span class="math display">\[\overrightarrow{Speed_2} =    \begin{bmatrix}        -yV - \frac{x_{a} z_{a}^2 U\cos{\theta}}{D_{xy} D_{xyz}} \\        xV - \frac{y z^2 U \cos{\theta}}{D_{xy} D_{xyz}} \\        \frac{z_{a} U \cos{\theta}}{D_{xyz}}    \end{bmatrix} \]</span> 当 <span class="math inline">\(\theta \in(0, \pi)\)</span>时，取解2；当 <span class="math inline">\(\theta \in(\pi, 2 \pi)\)</span>时，取解1；</p>]]></content>
    
    
    <categories>
      
      <category>GPS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>坐标系转换</tag>
      
      <tag>向量转换</tag>
      
      <tag>GPS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis-过期Key的删除策略</title>
    <link href="/linmu-blog/2024/08/26/Redis-%E8%BF%87%E6%9C%9FKey%E7%9A%84%E5%88%A0%E9%99%A4%E7%AD%96%E7%95%A5/"/>
    <url>/linmu-blog/2024/08/26/Redis-%E8%BF%87%E6%9C%9FKey%E7%9A%84%E5%88%A0%E9%99%A4%E7%AD%96%E7%95%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="删除策略">1. 删除策略</h1><p>Redis将键的过期时间对时间戳都保存在过期字典中，在删除时通过对比系统当前时间戳和存储的过期时间戳计算得到是否过期。那么如果一个键过期了，Redis是怎么将其删除的呢？我们可以推测出有这样几种删除策略：</p><ul><li>定时删除：在设置过期时间时，创建一个定时器，当定时器到键的过期时间时，进行删除操作。</li><li>惰性删除：当键达到过期时间时，放任其不管，但是当每次访问键时，都检查键是否过期，过期则将其删除。</li><li>定期删除：每隔一段时间，通过某个选择算法，对键的过期时间进行检查，删除过期键。</li></ul><h2 id="定时删除策略">1.1. 定时删除策略</h2><p>定时删除是保证键及时删除最有效的方式。但是定时器是对于CPU不友好的，当定时器与键一一对应时，大量的定时器会占用相当一部分的CPU时间。在业务繁忙时，将CPU时间用在删除与当前任务无关的键上，无疑会对服务器的响应时间和吞吐量造成影响。当然在一些场景下，通过算法优化，去只使用一个定时器触发所有键的过期事件，也是一条具备可行性的思路。</p><h2 id="惰性删除策略">1.2. 惰性删除策略</h2><p>惰性删除是对于CPU最友好的策略。程序仅需要消耗几乎可以忽略不计的CPU时间的操作就能触发键的过期事件，程序的关注点一直聚焦在相关的键上。惰性删除的缺点就和懒惰的不喜欢打扫的人一样，内存空间里面会有大量的“垃圾”。已经过期的键长期存在，只要这个键不被删除，其占用内存就不会释放。在极端情况下，当过期的键不再被访问时，那么它将永远不会被删除。这样的对于内存的浪费是极大的，我们可以理解这样的情况是一种内存泄露。</p><h2 id="定期删除策略">1.3. 定期删除策略</h2><p>定期删除就像是定时删除和惰性删除的折中方案。通过定期触发，减少对CPU时间的浪费；通过不再绑定键过期检查和键等其他操作，避免内存泄露，减少过期键对内存的浪费。定期策略也有两个难以权衡的变量：检查的广度、检查的频率：如果广度和频率过大，这样会浪费大量的CPU时间在遍历检查上；如果广度和频率过小，这样会使得检查并不全面，导致依旧有大量内存浪费。</p><hr /><h1 id="redis的删除策略">2. Redis的删除策略</h1><p>Redis的删除策略融合了惰性删除和定期删除，一方面Redis执行惰性删除，放任键过期；另一方面，为了权衡CPU和内存的浪费，Redis通过随机抽样选择部分键来进行过期检查及删除，当样本中的过期样本占比超过阈值时，再进行一次随机抽样。这样的算法很巧妙地运用狭义概率算法使得数据库中整体的内存浪费基本上在可控范围。然后这个策略也使得系统中的CPU和内存的浪费具备更强的随机性。我们可以推测出Redis的删除策略，一定有这样几个参数：</p><ul><li>定期抽样的时间间隔</li><li>抽样的样本数量</li><li>过期样本占比阈值</li></ul><p>时间间隔是通过配置参数<code>hz</code>设置的，默认为<code>10</code>，也就是一秒<code>10</code>次抽样，换算的时间间隔为<code>100ms</code>。</p><p>通过阅读Redis源码：在<code>6.0.0</code>版本之前，抽样的样本数量和过期样本占比阈值都是固定的，分别为<code>20</code>和<code>25%</code>。在<code>6.0.0</code>版本及之后，样本数量和阈值都取决于配置参数<code>active_exprie_effort</code>。</p><p><span class="math display">\[n_{样本最大数量} = 20 + 5\times(active\_exprie\_effort)\]</span></p><p><spanclass="math display">\[p_{过期占比阈值}=11-active\_exprie\_effort\]</span></p><p>当 \((n_{样本数量})(&gt;p_{过期占比阈值})\) 时，再进行一次采样。<code>active_exprie_effort</code>取值于\([1,10]\)，这个参数越大，则清理越彻底，占用的CPU时间越多。</p>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
      <tag>删除策略</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/linmu-blog/2024/08/24/hello-world/"/>
    <url>/linmu-blog/2024/08/24/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your veryfirst post. Check <a href="https://hexo.io/docs/">documentation</a> formore info. If you get any problems when using Hexo, you can find theanswer in <ahref="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> oryou can ask me on <ahref="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="quick-start">Quick Start</h2><h3 id="create-a-new-post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <ahref="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="run-server">Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="generate-static-files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <ahref="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="deploy-to-remote-sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <ahref="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
